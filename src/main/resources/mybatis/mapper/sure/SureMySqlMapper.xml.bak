<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.cmcc.es.chinapowerit.calibration.sure.mapper.SureMySqlMapper"> 

  <resultMap id="ECTCNSuppWinlistMap" type="cn.cmcc.es.chinapowerit.calibration.sure.pojo.ECTCNSuppWin">
		<result column="reply_id" jdbcType="VARCHAR"        property="replyId" />        		                
        <result column="project_id" jdbcType="VARCHAR"      property="projectId" />                         
        <result column="package_id" jdbcType="VARCHAR"      property="packageId" />                         
        <result column="package_name" jdbcType="VARCHAR"    property="packageName" />                       
        <result column="supplier_id" jdbcType="VARCHAR"     property="supplierId" />                        
        <result column="supplier_name" jdbcType="VARCHAR"   property="supplierName" />                      
        <result column="is_candidate" jdbcType="VARCHAR"    property="isCandidate" />                       
        <result column="candidate_sort" jdbcType="VARCHAR"  property="candidateSort" />                     
        <result column="win_id" jdbcType="VARCHAR"          property="winId" />                             
        <result column="price" jdbcType="VARCHAR"           property="price" />                             
        <result column="tax" jdbcType="VARCHAR"             property="tax" />                               
        <result column="win_money" jdbcType="VARCHAR"       property="totalTaxPrice" />                     
        <result column="win_proportion" jdbcType="VARCHAR"   	 property="winProportion" />                     
        <result column="winSuppType" jdbcType="VARCHAR"    	 	property="winSuppType" />                       
        <result column="is_winbak" jdbcType="VARCHAR"       	property="isWinBak" />                 
        <result column="product_id" jdbcType="VARCHAR"      	property="productId" />                         
        <result column="product_describe" jdbcType="VARCHAR" 	property="productDescribe" />                   
        <result column="project_num" jdbcType="VARCHAR"     	property="projectNum" />                        
        <result column="win_count" jdbcType="VARCHAR"         	property="winCount" />                   
  </resultMap>
  
    <resultMap id="SptSuppSupplierBaseResultMap" type="cn.cmcc.es.chinapowerit.api.model.bid.SptSuppSupplier">
    <result column="supplier_id" jdbcType="VARCHAR" property="supplierId" />
    <result column="is_valid" jdbcType="VARCHAR" property="isValid" />
    <result column="supplier_name" jdbcType="VARCHAR" property="supplierName" />
    <result column="org_no" jdbcType="VARCHAR" property="orgNo" />
    <result column="licence_no" jdbcType="VARCHAR" property="licenceNo" />
    <result column="unified_social_credit_code" jdbcType="VARCHAR" property="unifiedSocialCreditCode" />
    <result column="active_type" jdbcType="CHAR" property="activeType" />
    <result column="allow_change_file" jdbcType="VARCHAR" property="allowChangeFile" />
    <result column="audit_status" jdbcType="CHAR" property="auditStatus" />
    <result column="audit_time" jdbcType="INTEGER" property="auditTime" />
    <result column="bjca_sync" jdbcType="VARCHAR" property="bjcaSync" />
    <result column="buiness_limit_date" jdbcType="VARCHAR" property="buinessLimitDate" />
    <result column="business_number" jdbcType="VARCHAR" property="businessNumber" />
    <result column="cataloglevel" jdbcType="INTEGER" property="cataloglevel" />
    <result column="certificate_code" jdbcType="VARCHAR" property="certificateCode" />
    <result column="certificate_style" jdbcType="VARCHAR" property="certificateStyle" />
    <result column="certificate_type" jdbcType="VARCHAR" property="certificateType" />
    <result column="company_type" jdbcType="VARCHAR" property="companyType" />
    <result column="company_property" jdbcType="VARCHAR" property="companyProperty" />
    <result column="contact_man" jdbcType="VARCHAR" property="contactMan" />
    <result column="contact_man_email" jdbcType="VARCHAR" property="contactManEmail" />
    <result column="contact_man_id" jdbcType="VARCHAR" property="contactManId" />
    <result column="contact_man_tel" jdbcType="VARCHAR" property="contactManTel" />
    <result column="corporation_name" jdbcType="VARCHAR" property="corporationName" />
    <result column="create_date_bak" jdbcType="DATE" property="createDateBak" />
    <result column="credit_grade" jdbcType="CHAR" property="creditGrade" />
    <result column="district_file" jdbcType="VARCHAR" property="districtFile" />
    <result column="district_tax" jdbcType="VARCHAR" property="districtTax" />
    <result column="duns_number" jdbcType="VARCHAR" property="dunsNumber" />
    <result column="english_name" jdbcType="VARCHAR" property="englishName" />
    <result column="epp_sync" jdbcType="VARCHAR" property="eppSync" />
    <result column="fandation_date" jdbcType="VARCHAR" property="fandationDate" />
    <result column="higher_management" jdbcType="VARCHAR" property="higherManagement" />
    <result column="higher_management_code" jdbcType="VARCHAR" property="higherManagementCode" />
    <result column="id_number" jdbcType="VARCHAR" property="idNumber" />
    <result column="important_lock" jdbcType="CHAR" property="importantLock" />
    <result column="industry_code" jdbcType="VARCHAR" property="industryCode" />
    <result column="int_unit_type" jdbcType="CHAR" property="intUnitType" />
    <result column="is_agent" jdbcType="CHAR" property="isAgent" />
    <result column="is_china" jdbcType="CHAR" property="isChina" />
    <result column="is_listed_company" jdbcType="CHAR" property="isListedCompany" />
    <result column="is_lock" jdbcType="CHAR" property="isLock" />
    <result column="is_member" jdbcType="CHAR" property="isMember" />
    <result column="is_type" jdbcType="CHAR" property="isType" />
    <result column="licence_file_code" jdbcType="VARCHAR" property="licenceFileCode" />
    <result column="licence_file_copy" jdbcType="VARCHAR" property="licenceFileCopy" />
    <result column="licence_file_passdate" jdbcType="VARCHAR" property="licenceFilePassdate" />
    <result column="licence_period" jdbcType="VARCHAR" property="licencePeriod" />
    <result column="licence_sign_date" jdbcType="VARCHAR" property="licenceSignDate" />
    <result column="licence_year_date" jdbcType="VARCHAR" property="licenceYearDate" />
    <result column="licence_yearcheck_date" jdbcType="VARCHAR" property="licenceYearcheckDate" />
    <result column="listed_address" jdbcType="VARCHAR" property="listedAddress" />
    <result column="lodge_tell" jdbcType="VARCHAR" property="lodgeTell" />
    <result column="main_business_name" jdbcType="VARCHAR" property="mainBusinessName" />
    <result column="mdm_no" jdbcType="VARCHAR" property="mdmNo" />
    <result column="model_code" jdbcType="VARCHAR" property="modelCode" />
    <result column="modify_audit" jdbcType="VARCHAR" property="modifyAudit" />
    <result column="name_change" jdbcType="CHAR" property="nameChange" />
    <result column="national_tax" jdbcType="VARCHAR" property="nationalTax" />
    <result column="org_struct_file_code" jdbcType="VARCHAR" property="orgStructFileCode" />
    <result column="org_yera_date" jdbcType="VARCHAR" property="orgYeraDate" />
    <result column="organ_file_code" jdbcType="VARCHAR" property="organFileCode" />
    <result column="organ_file_passdate" jdbcType="VARCHAR" property="organFilePassdate" />
    <result column="organization_certificate_type" jdbcType="VARCHAR" property="organizationCertificateType" />
    <result column="paidin_capital" jdbcType="VARCHAR" property="paidinCapital" />
    <result column="paidin_currency" jdbcType="VARCHAR" property="paidinCurrency" />
    <result column="parent_name" jdbcType="VARCHAR" property="parentName" />
    <result column="post_code" jdbcType="VARCHAR" property="postCode" />
    <result column="ratify_number" jdbcType="VARCHAR" property="ratifyNumber" />
    <result column="recommend_company" jdbcType="VARCHAR" property="recommendCompany" />
    <result column="reg_address" jdbcType="VARCHAR" property="regAddress" />
    <result column="reg_address_no" jdbcType="VARCHAR" property="regAddressNo" />
    <result column="reg_address_postcode" jdbcType="VARCHAR" property="regAddressPostcode" />
    <result column="reg_area" jdbcType="VARCHAR" property="regArea" />
    <result column="reg_capital" jdbcType="VARCHAR" property="regCapital" />
    <result column="reg_city" jdbcType="VARCHAR" property="regCity" />
    <result column="reg_country" jdbcType="VARCHAR" property="regCountry" />
    <result column="reg_currency" jdbcType="VARCHAR" property="regCurrency" />
    <result column="reg_province" jdbcType="VARCHAR" property="regProvince" />
    <result column="remarks" jdbcType="VARCHAR" property="remarks" />
    <result column="short_name" jdbcType="VARCHAR" property="shortName" />
    <result column="supp_company_type" jdbcType="VARCHAR" property="suppCompanyType" />
    <result column="supplier_type_code" jdbcType="VARCHAR" property="supplierTypeCode" />
    <result column="tax_address" jdbcType="VARCHAR" property="taxAddress" />
    <result column="tax_identify" jdbcType="VARCHAR" property="taxIdentify" />
    <result column="taxreg_file_code" jdbcType="VARCHAR" property="taxregFileCode" />
    <result column="taxreg_file_passdate" jdbcType="VARCHAR" property="taxregFilePassdate" />
    <result column="tel_fax" jdbcType="VARCHAR" property="telFax" />
    <result column="tel_phone" jdbcType="VARCHAR" property="telPhone" />
    <result column="unit_address" jdbcType="VARCHAR" property="unitAddress" />
    <result column="unit_divide" jdbcType="CHAR" property="unitDivide" />
    <result column="unit_type" jdbcType="VARCHAR" property="unitType" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="web_site" jdbcType="VARCHAR" property="webSite" />
       <result column="audit_tips" jdbcType="LONGVARCHAR" property="auditTips" />
    <result column="business_scope" jdbcType="LONGVARCHAR" property="businessScope" />
  </resultMap>
  
	<select id="listECTCNSuppWin" resultMap="ECTCNSuppWinlistMap">
				SELECT T1.reply_id,
			       T1.project_id,
			       T1.package_id,
			       T1.package_name,
			       T1.supplier_id,
			       T1.supplier_name,
			       T1.is_candidate,
			       T1.candidate_sort,
			       T1.supp_type as winSuppType,
			       T1.product_id,
			       T1.product_describe,
			       T1.project_num,
				   T1.is_winbak,
			       T2.product_id,
			       T2.win_id,
			       T2.price,
			       T2.tax,
			       T2.win_money,
			       T2.PACKAGE_ID,
			       T2.SUPPLIER_ID,
			       T2.win_proportion,
			       T2.win_count
			  FROM (select t.reply_id,
			               t.project_id,
			               t.package_id,
			               t.package_name,
			               t.supplier_id,
			               t.supplier_name,
			               t.is_candidate,
			               t.candidate_sort,
			               t.supp_type,
			               pp.product_id,
			               pp.product_describe,
			               pp.project_num,
			                ( case when (select count(*)
			                        from ect_cn_win t3
			                       where t3.supplier_id = t.supplier_id
			                         and t3.package_id = t.package_id
			                         and t3.DEL_FLG = '1')=0 then 'N'
			                       ELSE 'Y'  END
			
										) is_winbak
			          from ect_cn_supp_reply t, ect_cn_project_product pp
			         where t.PACKAGE_ID = pp.PACKAGE_ID
			           AND T.PACKAGE_ID = #{packageId}
			           AND t.number_turn = #{numberTurn}
			           AND T.repeal_Status = 'N'
			           AND T.reply_Status = 'REPLY'
			           AND T.IS_OPEN_BID = 'Y'
			           AND T.IS_CANDIDATE = 'Y'
			           and T.DEL_FLG = '1'
			           and pp.DEL_FLG = '1') T1
			  LEFT JOIN (SELECT tw.product_id,
			                    tw.win_id,
			                    tw.price,
			                    tw.tax,
			                    tw.win_money,
			                    TW.PACKAGE_ID,
			                    TW.SUPPLIER_ID,
			                    tw.win_proportion,
			                    tw.is_winbak,
			                    tw.win_count
			               from ect_cn_win tw
			              where tw.DEL_FLG = '1'
			                AND TW.PACKAGE_ID = #{packageId}) T2
			    ON T1.PACKAGE_ID = T2.PACKAGE_ID
			   AND (T1.SUPPLIER_ID = T2.SUPPLIER_ID)
			   and t1.product_id = t2.product_id
			 order by T1.candidate_sort, T1.supplier_id, T1.product_id asc
	 
	</select>
	
	<select id="getAllOkSupps1" resultMap="SptSuppSupplierBaseResultMap">
			select *
			  from (select *
			          from (select distinct r.*
			                  from spt_supp_supplier r
			                  left join ect_cn_project_supplier t
			                    on r.supplier_id = t.supplier_id
			                 where r.del_flg = '0'
			                   and r.audit_status != '1'
			                   and t.del_flg = '0'
			                   and t.status_reply = 'PASS') a
			        UNION
			        select *
			          from (select distinct r.*
			                  from spt_supp_supplier r
			                 where r.DEL_FLG = '0'
			                   and r.audit_status = '1'
			                   and r.COMPANY_TYPE not in ('QYFRLX8', 'QYFRLX9')) b) c
			 where 1 = 1
			 <if test="supplierName != null">
		       and c.supplier_name like concat('%',#{supplierName },'%')
		      </if>
		      <if test="companyType != null">
		       and c.company_type =#{companyType }
		      </if>
	</select>
	
	<select id="getAllOkSupps2" resultMap="SptSuppSupplierBaseResultMap">
		 select * from (select *  from (select distinct r.*
			from spt_supp_supplier r 
			left join ect_cn_project_supplier t 
			on r.supplier_id = t.supplier_id 
			where r.DEL_FLG ='0' 
			and r.audit_status != '1' 
		 
			and t.DEL_FLG ='0' 
			and t.status_reply = 'PASS' ) a 
			UNION 
			select * 
			from (select distinct r.*
			from spt_supp_supplier r 
			where r.DEL_FLG ='0' 
			and r.audit_status = '1'  ) b ) c where 1 = 1
			<if test="supplierName != null">
		       and c.supplier_name like concat('%',#{supplierName },'%')
		      </if>
		      <if test="companyType != null">
		       and c.company_type =#{companyType }
		      </if>
	
	</select>
	<select id="superManagerSelect" parameterType="String" resultType="java.util.LinkedHashMap"> 
		${value} 
	</select>
	
</mapper>